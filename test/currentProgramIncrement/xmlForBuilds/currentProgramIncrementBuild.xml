<project name="6 - GW Testing" default="resolve" xmlns:ivy="antlib:org.apache.ivy.ant">
    <property name="lib.dir" location="C:/dev/.ivy2/cache"/>
    <property name="res.dir" location="../TestNGReports"/>
    <property name="GWPersistence.ivy.file" value="C:/tmp/svncheckouts/guidewire/GWPersistenceIvy/gwpersistence-ivy.xml"/>
    <property name="GWRepository.ivy.file" value="C:/tmp/svncheckouts/guidewire/GWRepositoryIvy/gwrepository-ivy.xml"/>
    <property name="GWServices.ivy.file" value="C:/tmp/svncheckouts/guidewire/GWServicesIvy/gwservices-ivy.xml"/>
    <property name="GWTesting.ivy.file" value="C:/tmp/svncheckouts/guidewire/GWTestingIvy/gwtesting-ivy.xml"/>
    <property name="logging.config.directory.path" location="C:/tmp/svncheckouts/guidewire"/>

    <path id="lib.classpath">
        <fileset dir="${lib.dir}">
            <include name="**/*.jar"/>
        </fileset>
    </path>

    <path id="combined.classpath">
        <path refid="lib.classpath"/>
    </path>

    <target name="init" description="initialize the build environment">
        <tstamp/>

        <delete dir="${res.dir}"/>
        <mkdir dir="${res.dir}"/>

        <delete includeemptydirs="true" failonerror="false">
            <fileset dir="C:/Users/qauser/.ivy2/cache/com.idfbins.guidewire">
                <include name="*/"/>
                <exclude name="GWPersistence/"/>
                <exclude name="GWRepository/"/>
                <exclude name="GWServices/"/>
                <exclude name="GWTesting/"/>
            </fileset>
        </delete>
    </target>

    <target name="resolve" depends="init" description="retrieve dependencies with ivy">
        <delete file="C:/dev/.ivy2/cache/default/GWPersistence-jar-1.0.jar" failonerror="false"/>
        <delete file="C:/dev/.ivy2/cache/default/GWRepository-jar-1.0.jar" failonerror="false"/>
        <delete file="C:/dev/.ivy2/cache/default/GWServices-jar-1.0.jar" failonerror="false"/>
        <delete file="C:/dev/.ivy2/cache/default/GWTesting-jar-1.0.jar" failonerror="false"/>

        <ivy:configure file="C:/dev/.ivy2/ivysettings.xml"/>

        <ivy:resolve file="${GWPersistence.ivy.file}"/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[type]-[revision].[ext]"/>

        <ivy:resolve file="${GWRepository.ivy.file}"/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[type]-[revision].[ext]"/>

        <ivy:resolve file="${GWServices.ivy.file}"/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[type]-[revision].[ext]"/>

        <ivy:resolve file="${GWTesting.ivy.file}"/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[type]-[revision].[ext]"/>

        <ivy:resolve file="C:/tmp/svncheckouts/guidewire/ivy-xml-for-ant-builds/ivy.xml"/>
        <ivy:retrieve pattern="${lib.dir}/[conf]/[artifact]-[type]-[revision].[ext]"/>
    </target>

    <target name="run-current-pi" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles" includes="currentProgramIncrement.xml"/>
        </testng>
    </target>

    <target name="run-cpiClock" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles"
                        includes="cpiClockMove.xml"/>
        </testng>
    </target>

    <target name="run-cpiClock1" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles"
                        includes="cpiClockMove1.xml"/>
        </testng>
    </target>

    <target name="run-cpiClock2" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles"
                        includes="cpiClockMove2.xml"/>
        </testng>
    </target>

    <target name="run-cpiClock3" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles"
                        includes="cpiClockMove3.xml"/>
        </testng>
    </target>

    <target name="run-cpiClock4" depends="resolve">
        <taskdef name="testng" classpathref="lib.classpath" classname="org.testng.TestNGAntTask">
            <classpath>
                <pathelement location="../../lib/default/testng-6.14.2.jar"/>
            </classpath>
        </taskdef>

        <echo message="Running Tests..."/>
        <property environment="env"/>
        <property environment="host"/>
        <property environment="jenkinsBuildNumber"/>
        <testng classpathref="combined.classpath" outputDir="${res.dir}" haltOnfailure="false">
            <sysproperty key="env" value="${env.env}"/>
            <sysproperty key="host" value="${host.host}"/>
            <sysproperty key="jenkinsBuildNumber" value="${jenkinsBuildNumber.jenkinsBuildNumber}"/>
            <classpath location="combined.classpath"/>
            <jvmarg value="-Dlogback.configurationFile=${logging.config.directory.path}/logback.xml"/>
            <xmlfileset dir="C:/tmp/svncheckouts/guidewire/JobXMLFiles"
                        includes="cpiClockMove4.xml"/>
        </testng>
    </target>

</project>